
{% extends "layouts.html" %}
{% load static %}
{% block title %}Chat | CareMap{% endblock %}

{% block extra_head %}
  <style>
    /* Chat page customizable styles (inline) */
    :root {
      --chat-card-bg: #ffffff;
      --chat-card-radius: 12px;
      --chat-card-shadow: 0 6px 24px rgba(0, 0, 0, 0.12);
      --chat-header-bg: #f8f9fa;
      --chat-header-border: #e9ecef;
      --chat-container-min-height: 60vh;
      --chat-max-width: 520px;
    }

    .chat-container {
      background-color: #ffffff;
      padding: 2rem;
      border-radius: 15px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    }

    .chat-card {
      width: 100%;
      max-width: 100%;
      border-radius: 0;
      box-shadow: none;
      background: transparent;
      border: none;
    }

    .chat-card .card-header {
      background-color: var(--chat-header-bg);
      border-bottom: 1px solid var(--chat-header-border);
    }
    /* Simple inline popup */
    .inline-toast {
      position: fixed;
      top: 16px;
      left: 50%;
      transform: translateX(-50%);
      background: #212529;
      color: #fff;
      padding: 10px 16px;
      border-radius: 8px;
      box-shadow: 0 6px 24px rgba(0,0,0,0.12);
      font-size: 0.95rem;
      z-index: 1050;
      display: none;
    }
  </style>
{% endblock %}

{% block content %}
  <div class="container chat-container mt-4 mt-md-5">
    <div class="card chat-card">
      <div class="card-header">
        <h5 class="mb-0">Start a New Chat</h5>
      </div>
      <div class="card-body">
        {% if not request.user.is_authenticated %}
          <div class="alert alert-info mb-3">
            Login to save chat and use personalized experience.
          </div>
        {% endif %}
        <form action="/chat" method="post" id="chatForm">
          {% csrf_token %}

          <div class="mb-3">
            <label for="name" class="form-label">Name</label>
            <input
              type="text"
              id="name"
              name="name"
              class="form-control"
              placeholder="Enter your name"
              value="{{ initial_name|default:'' }}"
            />
            
          </div>

          <div class="mb-3">
            <label for="age" class="form-label">Age</label>
            <input
              type="number"
              id="age"
              name="age"
              class="form-control"
              placeholder="Enter your age"
              min="0"
              value="{{ initial_age|default:'' }}"
            />
            
          </div>

          <div class="mb-3">
            <label for="symptoms" class="form-label">Describe Your Symptoms</label>
            <textarea
              id="symptoms"
              name="symptoms"
              class="form-control"
              rows="4"
              placeholder="Describe your symptoms"
            ></textarea>
            
          </div>

          {% if request.user.is_authenticated %}
          <div class="form-check mb-3">
            <input class="form-check-input" type="checkbox" id="use_history" name="use_history" checked>
            <label class="form-check-label" for="use_history">Include my past symptom history</label>
          </div>
          {% endif %}

          <div class="mb-3">
            <label for="history_title" class="form-label">Past History</label>
            <input
              type="text"
              id="history_title"
              name="history_title"
              class="form-control"
              placeholder="e.g., Recent medical issues"
            />
          </div>

          <button type="submit" class="btn btn-primary w-100">Submit</button>
        </form>
      </div>
      <div class="card-footer bg-white">
        <button class="btn btn-outline-secondary w-100" onclick="window.history.back();">Go Back</button>
      </div>
    </div>
  </div>
  <div id="inlineToast" class="inline-toast">This is missing</div>
{% endblock %}

{% block extra_scripts %}
  <script>
    (function() {
      function showToast(message) {
        var toast = document.getElementById('inlineToast');
        toast.textContent = message || ' is missing';
        toast.style.display = 'block';
        setTimeout(function() {
          toast.style.display = 'none';
        }, 2000);
      }

      var form = document.getElementById('chatForm');
      if (form) {
        form.addEventListener('submit', function(e) {
          var name = (document.getElementById('name').value || '').trim();
          var age = (document.getElementById('age').value || '').trim();
          var symptoms = (document.getElementById('symptoms').value || '').trim();

          if (!name) {
            e.preventDefault();
            showToast('Name is missing');
          }
          if ( !age ) {
            e.preventDefault();
            showToast('Age is missing');
          }
          if ( !symptoms) {
            e.preventDefault();
            showToast('Symptoms are missing');
          }
          
        });
      }
    })();
  </script>
{% endblock %}
