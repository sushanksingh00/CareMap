{% extends "layouts.html" %}
{% block title %}CareMap{% endblock %}
{% block extra_head %}
    <link href="/static/favicon.ico" rel="icon">
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@100..900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet">
    <style>
        /* Prevent horizontal scrolling */
        html, body {
            overflow-x: hidden;
            width: 100%;
        }
        
        body {
            background-color: #ffffff;
            color: #212529;
            font-family: "Outfit", sans-serif;
        }
        
        .navbar-custom {
            background-color: #f8f9fa;
            padding: 15px 0;
        }
        
        .nav-icons {
            transition: transform 0.1s ease-in;
            fill: currentColor;
            color: #212529;
            width: 24px;
            height: 24px;
        }
        
        .nav-icons:hover {
            transform: translateY(-5px);
        }
        
        .logo-container {
            height: 40px; /* Fixed height for logo */
            width: auto; /* Auto width to maintain aspect ratio */
        }
        
        .gradient-curve {
            height: 80vh;
            width: 100%;
            max-width: 100%;
            background: linear-gradient(45deg, #3B1E54, #9B7EBD, #D4BEE4, #EEEEEE);
            border-radius: 35% 65% 49% 51% / 73% 23% 77% 27%;
        }
        
        .ai-image {
            height: 100%;
            width: 100%;
            object-fit: contain;
            mix-blend-mode: multiply;
            position: relative;
            z-index: 1;
        }
        
        .intro-text {
            font-family: "Outfit", sans-serif;
            font-weight: 700;
            text-align: center;
            color: #212529;
            font-size: clamp(1.5rem, 4vw, 2.5rem); /* Responsive font size */
            margin-bottom: 15px;
            line-height: 1.2;
        }
        
        .description-text {
            font-family: "Outfit", sans-serif;
            font-weight: 400;
            color: #495057;
            font-size: clamp(1rem, 2vw, 1.25rem); /* Responsive font size */
            padding-bottom: 20px;
            line-height: 1.5;
        }
        
        .disclaimer-text {
            color: #b00020;
            font-weight: 600;
            margin-top: 1rem;
            display: block;
            font-size: clamp(0.8rem, 1.5vw, 1rem);
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .gradient-curve {
                height: 50vh;
                border-radius: 0 0 50% 50% / 0 0 30% 30%;
            }
            
            .navbar-collapse {
                background-color: rgba(0,0,0,0.9);
                padding: 15px;
                border-radius: 10px;
                margin-top: 10px;
            }
            
            .nav-item {
                margin: 5px 0;
            }
        }
        
        /* Ensure content containers don't overflow */
        .container-fluid {
            padding-left: 15px;
            padding-right: 15px;
        }
        
        .row {
            margin-left: 0;
            margin-right: 0;
        }
        
        /* Image container adjustments */
        .image-container {
            position: relative;
            height: 100%;
            overflow: hidden;
        }

        /* New homepage layout */
        .hero-wrap {
            position: relative;
            width: 100%;
            height: 60vh;
            border-radius: 12px;
            overflow: hidden;
        }

        .hero-banner {
            position: absolute;
            inset: 0;
            background: url('/static/2106.w023.n001.506B.p1.506.jpg') center center / cover no-repeat;
            filter: blur(4px);
        }

        .hero-cta {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1;
        }

        .cta-buttons {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
        }
        .cta-buttons .btn {
            padding: 10px 18px;
            font-weight: 600;
            border-radius: 10px;
        }

        /* Inline overlay with blurred background */
        .inline-overlay {
            position: fixed;
            inset: 0;
            backdrop-filter: blur(6px);
            background: rgba(255, 255, 255, 0.35);
            z-index: 1050;
            display: none;
        }
        .inline-modal {
            position: relative;
            max-width: 900px; /* wide and consistent */
            width: calc(100% - 32px); /* responsive padding on small screens */
            margin: 10vh auto;
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            overflow: hidden;
        }
        .inline-modal .modal-header {
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
            padding: 0.75rem 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .inline-modal .modal-body {
            padding: 1rem;
            max-height: 70vh; /* scroll inside modal, not page */
            overflow-y: auto;
        }
        .inline-close {
            border: none;
            background: transparent;
            color: #495057;
            font-weight: 600;
        }
    </style>
{% endblock %}
{% block content %}

    <!-- Main Content: Rectangle banner, then buttons, then text -->
    <div class="container-fluid mt-5 pt-5">
        <!-- Rectangle banner with the image and independent overlay for centered buttons -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="hero-wrap">
                    <div class="hero-banner"></div>
                    <div class="hero-cta">
                        <div class="cta-buttons">
                            <a href="/history" id="btnHistory" class="btn btn-light text-dark">View History</a>
                            <a href="/chat" id="btnChat" class="btn btn-primary">Start New Chat</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Buttons removed here since they are inside the banner -->

        <!-- Text content under the buttons -->
        <div class="row">
            <div class="col-lg-8 mx-auto">
                <h1 class="intro-text">Redefining Healthcare Guidance With Personalized AI Symptom Analysis</h1>

                <p class="description-text text-center">
                    CareMap harnesses the power of artificial intelligence to provide you with instant, personalized insights into your symptoms. By analyzing your unique health data, it helps you understand potential causes and guides you toward informed next steps â€” all from the convenience of your device.
                </p>
                
            </div>
        </div>
    </div>
{% endblock %}
{% block extra_scripts %}
    <script>
        (function() {
            const overlayId = 'inlineOverlay';

            function ensureOverlay() {
                let overlay = document.getElementById(overlayId);
                if (!overlay) {
                    overlay = document.createElement('div');
                    overlay.id = overlayId;
                    overlay.className = 'inline-overlay';
                    document.body.appendChild(overlay);
                    // Close when clicking outside the modal
                    overlay.addEventListener('click', function(e) {
                        if (e.target.id === overlayId) hideOverlay();
                    });
                }
                return overlay;
            }

            function showOverlay(contentHtml, titleText) {
                const overlay = ensureOverlay();
                overlay.innerHTML = `
                    <div class="inline-modal">
                        <div class="modal-header">
                            <span>${titleText || ''}</span>
                            <button class="inline-close" id="inlineClose">Close</button>
                        </div>
                        <div class="modal-body">${contentHtml}</div>
                    </div>`;
                overlay.style.display = 'block';
                // Prevent background page from scrolling while modal is open
                document.body.style.overflow = 'hidden';
                const closeBtn = document.getElementById('inlineClose');
                closeBtn && closeBtn.addEventListener('click', hideOverlay);
            }

            function hideOverlay() {
                const overlay = document.getElementById(overlayId);
                if (overlay) overlay.style.display = 'none';
                // Restore background page scrolling
                document.body.style.overflow = '';
            }

            function getCookie(name) {
                const value = `; ${document.cookie}`;
                const parts = value.split(`; ${name}=`);
                if (parts.length === 2) return parts.pop().split(';').shift();
            }

            function renderChatFormHtml() {
                const csrf = getCookie('csrftoken') || '';
                return `
                    <form action="/chat" method="post" id="inlineChatForm">
                        <input type="hidden" name="csrfmiddlewaretoken" value="${csrf}">
                        <div class="mb-3">
                            <label for="name" class="form-label">Name</label>
                            <input type="text" id="name" name="name" class="form-control" placeholder="Enter your name"
                                value="{% if request.user.is_authenticated and request.user.profile and request.user.profile.name %}{{ request.user.profile.name }}{% endif %}">
                        </div>
                        <div class="mb-3">
                            <label for="age" class="form-label">Age</label>
                            <input type="number" id="age" name="age" class="form-control" placeholder="Enter your age" min="0"
                                value="{% if request.user.is_authenticated and request.user.profile and request.user.profile.age %}{{ request.user.profile.age }}{% endif %}">
                        </div>
                        <div class="mb-3">
                            <label for="symptoms" class="form-label">Describe Your Symptoms</label>
                            <textarea id="symptoms" name="symptoms" class="form-control" rows="4" placeholder="Describe your symptoms"></textarea>
                        </div>
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="use_history" name="use_history" checked>
                            <label class="form-check-label" for="use_history">Include my past symptom history</label>
                        </div>
                        <div class="mb-3">
                            <label for="history_title" class="form-label">Past History Title</label>
                            <input type="text" id="history_title" name="history_title" class="form-control" placeholder="e.g., Recent medical issues">
                        </div>
                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-primary">Submit</button>
                            <button type="button" class="btn btn-outline-secondary" id="inlineClose2">Close</button>
                        </div>
                    </form>`;
            }

            // History: open default page via normal navigation (no overlay)

            // Wire up events
            const btnChat = document.getElementById('btnChat');
            const btnHistory = document.getElementById('btnHistory');
            if (btnChat) {
                btnChat.addEventListener('click', function(e) {
                    e.preventDefault();
                    const html = renderChatFormHtml();
                    showOverlay(html, 'Start a New Chat');
                    setTimeout(() => {
                        const close2 = document.getElementById('inlineClose2');
                        close2 && close2.addEventListener('click', hideOverlay);
                    }, 50);
                });
            }
            // Do not intercept history; allow default navigation to /history
        })();
    </script>
{% endblock %}
